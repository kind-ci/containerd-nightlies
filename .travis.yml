dist: bionic
sudo: required
language: go
os:
- linux
go:
- 1.12.x
addons:
  apt:
    packages:
    - btrfs-tools
    - libseccomp-dev
before_install:
- uname -r
install:
- go get -u github.com/containerd/containerd
- cd $GOPATH/src/github.com/containerd/containerd
script:
- export gitUnix="$(git log -1 --pretty='%ct')"
- export gitDate="$(date --utc --date "@$gitUnix" +'%Y%m%d%H%M%S')"
- export gitCommit="$(git log -1 --pretty='%h')"
- export TRAVIS_TAG="v0.0.0-${gitDate}-${gitCommit}"
- sudo PATH=$PATH GOPATH=$GOPATH $TRAVIS_BUILD_DIR/release-containerd-nightly.sh
before_deploy:
- git config --local user.name "Nightly bot"
- git config --local user.email "nightly.bot@noemail.com"
- cd $TRAVIS_BUILD_DIR
- git tag $TRAVIS_TAG
deploy:
- provider: releases
  api_key:
  secure: N4jVRUKgWm3Mi/emfAPNXV1+BxvzxjNMslOThT3m/9c3so6plyKwndtix0/C4cvbNWMHZYhnV6b1hYtHrMrmHP2tGBkoaPfYUQ/c7idLJis6hTz+4I55Am25CP7mSURdjo0p0BfObFnfYq8ePgn0chFK3N8pp/7eMdEsUCHsP9BlB6Lz+Go/HgrMyob8rjPOmgOq5zTu/7NhGug5DN6NXhymIvMUBbhekE2BCsb1EVa7PUyJzfzQ9DyJoKqXyR2aIUjEAudZzhJQLQ/i2pDFrAXIInZ7rz4w310jB4vbNeeYB0W+gV9dzxgOqF1n3Jc34ydfo9SqkjvMtECjX16y5unW8114PvoB4HpBUfMLGQt5xXS0fiPYyCq1yvPDFlCFMhpUwlsqRMOZoFDMXBpHA9gSjdIfvpCKl40i6e2YzKaYPNZ+YU5ImgFbW0rl5n7l5RuFK6vDm/AsHrob7esrPcdv67wHLJCQjrvR/XpK3zsYILzPVucBuj6sBIbNJHUEts7qbAdu4KfR2I5AGwH9obVOWzcadI48fTcQvycVLdiFGUwhBqB/0OiMR2VIGtIQuDTAd11EmFNz6X/C8whsAbAkYcmYhKgkwFVmrawwAsfKEfuqNpJ/RekyGTrr7zKvfXoRDxtF+rolyXxU5ovHlgZPFiv57BdYWGWEsO77C1o=
  file_glob: true
  file:
  - "$GOPATH/src/github.com/containerd/containerd/releases/*.tar.gz"
  - "$GOPATH/src/github.com/containerd/containerd/releases/*.tar.gz.sha256sum"
  skip_cleanup: true
  on:
    repo: kind-ci/containerd-nightlies
    tags: true
